<?xml version="1.0"?>
<!-- 
	adapter container主模块配置文件
-->

<module id="icsframework" version="1.0.0"
	package="com.hisun.framework">
	<!-- 线程池工厂配置 -->
	<service-point id="ThreadPoolFactory"
		interface="com.hisun.service.IThreadPoolFactory">
		<create-instance
			class="com.hisun.service.imp.HiThreadPoolFactory" />
	</service-point>

	<!-- 全局对象池工厂配置 
		<service-point id="GlobalObjectPool"
		interface="ObjectPool">
		<invoke-factory service-id="hivemind.BuilderFactory"
		model="singleton">
		<construct class="impl.ObjectPoolImpl"></construct>
		</invoke-factory>
		</service-point>
	-->

	<!-- handler工厂配置 -->
	<service-point id="handlerFactory"
		interface="org.apache.hivemind.lib.BeanFactory">
		<interceptor service-id="hivemind.LoggingInterceptor">
			<include method="get" />
		</interceptor>
		<invoke-factory service-id="hivemind.lib.BeanFactoryBuilder">
			<factory configuration-id="handlerBean"
				default-cacheable="false" />
		</invoke-factory>
	</service-point>

	<configuration-point id="handlerBean"
		schema-id="hivemind.lib.BeanFactoryContribution" />

	<!-- comm工厂配置 -->
	<service-point id="commFactory"
		interface="org.apache.hivemind.lib.BeanFactory">
		<interceptor service-id="hivemind.LoggingInterceptor">
			<include method="get" />
		</interceptor>
		<invoke-factory service-id="hivemind.lib.BeanFactoryBuilder">
			<factory configuration-id="declareBean"
				default-cacheable="false" />
		</invoke-factory>
	</service-point>

	<!-- 通讯配置 -->
	<configuration-point id="declareBean"
		schema-id="hivemind.lib.BeanFactoryContribution" />

	<contribution configuration-id="icsframework.declareBean">
		<bean name="BatchOnline"
			class="com.hisun.handler.HiBatchonlineHandler" cacheable="false" />
		<bean name="SysConnecter"
			class="com.hisun.handler.HiCONSVRHandler" cacheable="false" />
		<bean name="FileServer" class="com.hisun.handler.HiFileServer"
			cacheable="false" />
		<bean name="SysListener"
			class="com.hisun.handler.HiLSNSVRHandler" cacheable="false" />
		<bean name="Monitor" class="com.hisun.handler.HiMonHandler"
			cacheable="false" />
		<bean name="Parse8583"
			class="com.hisun.handler.HiParser8583Handler" cacheable="false" />
		<bean name="BatchListener"
			class="com.hisun.listener.HiBatchListener" cacheable="false" />
		<bean name="TimeListener"
			class="com.hisun.listener.HiTimeListener" cacheable="false" />
		<bean name="HttpConnector"
			class="com.hisun.protocol.http.ApacheHttpConnector"
			cacheable="false" />
		<bean name="TPELEngine" class="com.hisun.engine.HiEngine"
			cacheable="false" />
		<bean name="tcpSynListener"
			class="com.hisun.protocol.tcp.imp.HiTcpSynListener"
			cacheable="false" />
		<bean name="tcpSynConnector"
			class="com.hisun.protocol.tcp.imp.HiTcpSynConnector"
			cacheable="false" />
		<bean name="tcpASynListener"
			class="com.hisun.protocol.tcp.imp.HiTcpASynListener"
			cacheable="false" />
		<bean name="tcpASynConnector"
			class="com.hisun.protocol.tcp.imp.HiTcpASynConnector"
			cacheable="false" />
	</contribution>

	<contribution configuration-id="handlerBean">
		<bean name="callService" class="handler.HiCallServiceHandler"
			cacheable="false" />
		<bean name="callProcess" class="handler.HiCallProcessHandler"
			cacheable="false" />
		<bean name="addMsgHeader" class="handler.HiAddHeaderHandler"
			cacheable="false" />
		<bean name="PutMessage" class="handler.HiPutMsgHandler"
			cacheable="false" />
		<bean name="GetMessage" class="handler.HiWaitMsgHandler"
			cacheable="false" />
	</contribution>

	<!-- listener工厂配置 -->
	<service-point id="listenerFactory"
		interface="org.apache.hivemind.lib.BeanFactory">
		<invoke-factory service-id="hivemind.lib.BeanFactoryBuilder">
			<factory configuration-id="listenerBean"
				default-cacheable="false" />
		</invoke-factory>
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<configuration-point id="listenerBean"
		schema-id="hivemind.lib.BeanFactoryContribution" />

	<contribution configuration-id="listenerBean">
		<bean name="TCPListener" class="tcpimp.TCPSynListener"
			cacheable="false" />
	</contribution>

	<!-- connector工厂配置 -->
	<service-point id="connectorFactory"
		interface="org.apache.hivemind.lib.BeanFactory">
		<invoke-factory service-id="hivemind.lib.BeanFactoryBuilder">
			<factory configuration-id="connectorBean"
				default-cacheable="false" />
		</invoke-factory>
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<configuration-point id="connectorBean"
		schema-id="hivemind.lib.BeanFactoryContribution" />

	<contribution configuration-id="connectorBean">
		<bean name="TCPConnector" class="tcpimp.HiTCPConnector"
			cacheable="false" />
	</contribution>

	<!-- 配置文件解析模块配置 -->
	<service-point id="ConfigParser" interface="HiConfigParser">
		<invoke-factory>
			<construct class="parser.DigesterParserImp"></construct>
		</invoke-factory>
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<!-- 线程池配置 -->
	<service-point id="ThreadPool" interface="IThreadPool">
		<invoke-factory>
			<construct class="imp.BackportThreadPool">
				<set property="minSize" value="10" />
				<set property="maxSize" value="500" />
			</construct>
		</invoke-factory>
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<!-- 消息池配置 -->
	<service-point id="MessagePool" interface="IMsgPool">
		<create-instance class="imp.ETFMsgPool" />
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<!-- 容器配置 -->
	<service-point id="Container" interface="IManagedContainer">
		<invoke-factory>
			<construct class="imp.DefaultContainer">
				<set-service service-id="ConfigParser"
					property="parser" />
				<set-service service-id="ThreadPool"
					property="threadPool" />
				<set-service service-id="MessagePool"
					property="msgPool" />
			</construct>
		</invoke-factory>
		<interceptor service-id="hivemind.LoggingInterceptor" />
	</service-point>

	<!-- pipeline支持,只支持固定几个平台接口的pipeline -->
	<service-point id="PipelineBuilderFactory"
		interface="com.hisun.pipeline.PipelineBuilderFactory">
		<invoke-factory>
			<construct class="com.hisun.pipeline.PipelineBuilderFactoryImpl">
				<!--set-service property="classFactory"
					service-id="hivemind.ClassFactory" /-->
				<!--set-service property="defaultImplementationBuilder"
					service-id="hivemind.lib.DefaultImplementationBuilder" /-->
			</construct>
		</invoke-factory>
	</service-point>
	
	<!-- 对象装饰服务,平台公共服务 -->
	<service-point id="ObjectDecorator" interface="com.hisun.service.IObjectDecorator">
        <invoke-factory service-id="hivemind.lib.StrategyFactory">
            <construct configuration-id="ObjectDecoratorStrategies"/>
        </invoke-factory>
	</service-point>
	
    <configuration-point id="ObjectDecoratorStrategies" schema-id="hivemind.lib.StrategyRegistry"/>

    <contribution configuration-id="ObjectDecoratorStrategies">
        <strategy class="com.hisun.framework.HiDefaultServer" object="instance:com.hisun.framework.decorator.ServerDecorator"/>
        <strategy class="com.hisun.pubinterface.IHandler" object="instance:com.hisun.framework.decorator.HandlerDecorator"/>
    </contribution>

</module>
